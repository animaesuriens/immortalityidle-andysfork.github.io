<div cdkDragHandle [ngClass]="{'draggableCursor': !gameStateService.lockPanels}" class="panelHeader">
  <mat-icon>
    favorite
  </mat-icon>
  Health
  <mat-icon class="panelHelp" matTooltip="Maintaining your health is an important part of becoming immortal. If your health reaches 0, you will die and need to try for immortality once you are reincarnated in your next life.">
    help
  </mat-icon>
</div>
<h3>
  <table>
    <tr>
      <td class="headerCell">
        You are {{characterService.characterState.age / 365 | floor }} years@if (characterService.characterState.age < 10000 * 365) {
        <span>,
        {{characterService.characterState.age % 365 | number: '1.0-0'}} days</span>
        } old.
      </td>
      @if (characterService.characterState.immortal) {
        <td class="headerCell">
          You expect to live forever.
        </td>
      }
      @else {
        <td class="headerCell">
          You expect to live up to {{characterService.characterState.lifespan / 365 | floor}} years and {{characterService.characterState.lifespan % 365 | number: '1.0-0'}} days old.
        </td>
      }
      <!-- Hidden: lifespan info now shown in panel
      <td>
        <mat-icon matTooltip="{{characterService.lifespanTooltip}}">timer</mat-icon>
      </td>
-->
    </tr>
  </table>
</h3>
<div class="healthPanelContents">
  <div class="statusBarsGrid">
    <div class="lifespanInfo">{{characterService.lifespanTooltip}}</div>
    <div class="statusRow">
      <span class="statusLabel" matTooltip="{{characterService.characterState.status.health.description}}">Health</span>
      <div class="health">
        <div class="progress-bar" [ngClass]="flashHealth ? 'flash' : ''"
          [attr.value]="Math.floor(characterService.characterState.immortal && characterService.characterState.status.health.value < 0 ? 0 : characterService.characterState.status.health.value) | bigNumber"
          [attr.max]="Math.floor(characterService.characterState.status.health.max) | bigNumber">
          <span
            [style.width.%]="100 *
              Math.floor(characterService.characterState.immortal && characterService.characterState.status.health.value < 0 ? 0 : characterService.characterState.status.health.value) /
              Math.floor(characterService.characterState.status.health.max)">
          </span>
        </div>
      </div>
      <span class="statusLabel" matTooltip="{{characterService.characterState.status.stamina.description}}">Stamina</span>
      <div class="stamina">
        <div class="progress-bar" [ngClass]="flashStamina ? 'flash' : ''"
          [attr.value]="Math.floor(characterService.characterState.status.stamina.value) | bigNumber"
          [attr.max]="Math.floor(characterService.characterState.status.stamina.max) | bigNumber">
          <span
            [style.width.%]="100 *
              Math.floor(characterService.characterState.status.stamina.value) /
              Math.floor(characterService.characterState.status.stamina.max)">
          </span>
        </div>
      </div>
    </div>
    <div class="statusRow">
      <span class="statusLabel" matTooltip="{{characterService.characterState.status.nourishment.description}}">Nutrition</span>
      <div class="nourishment">
        <div class="progress-bar" [ngClass]="flashNutrition ? 'flash' : ''"
          [attr.value]="Math.floor(characterService.characterState.status.nourishment.value) | bigNumber"
          [attr.max]="Math.floor(characterService.characterState.status.nourishment.max) | bigNumber">
          <span
            [style.width.%]="100 *
              Math.floor(characterService.characterState.status.nourishment.value) /
              Math.floor(characterService.characterState.status.nourishment.max)">
          </span>
        </div>
      </div>
      <span class="statusLabel" matTooltip="{{characterService.characterState.status.mana.description}}">Mana</span>
      <div class="mana">
        <div class="progress-bar" [ngClass]="flashMana ? 'flash' : ''"
          [attr.value]="Math.floor(characterService.characterState.status.mana.value) | bigNumber"
          [attr.max]="Math.floor(characterService.characterState.status.mana.max) | bigNumber">
          <span
            [style.width.%]="100 *
            Math.floor(characterService.characterState.status.mana.value) /
            Math.floor(characterService.characterState.status.mana.max)">
          </span>
        </div>
      </div>
    </div>
  </div>
  @if (this.characterService.characterState.yinYangUnlocked) {
    <div class="yinYang"
    matTooltip="Yang: {{characterService.characterState.yang | bigNumber}}
    Yin: {{characterService.characterState.yin | bigNumber}}
    Your balance is {{balanceString}}.">
      <svg xmlns="http://www.w3.org/2000/svg" width="250" height="250" viewBox="0 0 1250 1250" [style.fill]="yinColor">
        <defs>
          <filter id="f">
            <feGaussianBlur stdDeviation="3.5"/>
          </filter>
        </defs>
        <circle cx="125" cy="125" r="116.6" fill="#7f7f7f" opacity="0.5" filter="url(#f)"/>
        <circle cx="125" cy="125" r="113.2" [style.fill]="yangColor"/>
        <path d="m125,11.8 a56.6,56.6 0 0 1 0,113.2 56.6,56.6 0 0 0 0,113.2 113.2,113.2 0 0 0 0,-226.4"/>
        <circle cx="125" cy="68.4" r="17.6" [style.fill]="yinColor"/>
        <circle cx="125" cy="181.6" r="17.6" [style.fill]="yangColor"/>
      </svg>
    </div>
  }
</div>
<div class="panelResizeHandle"></div>