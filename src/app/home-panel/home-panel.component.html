<div cdkDragHandle [ngClass]="{'draggableCursor': !gameStateService.lockPanels}" class="panelHeader">
  <mat-icon>
    home
  </mat-icon>
  Home
  <mat-icon class="panelHelp" matTooltip="Your home is an essential part of your life. A better home allows you to recover and has room for furniture that can aid your immortal development.">
    help
  </mat-icon>
</div>
<div class="homeContainer">
  <h3 >
    <div matTooltip="{{homeService.home.description}}" [ngClass]="{'hellDisabled': hellService.inHell}">
      You live in a {{homeService.home.name}}
    </div>
  </h3>
  @if ((!hellService.inHell || homeService.hellHome || homeService.hellFood)) {
    <div class="homeContainer">
      <div class="overflow">
        @if (homeService.home.healthRegen > 0 || homeService.home.staminaRegen > 0 || homeService.home.manaRegen > 0) {
          <div class="homeInfo"><span>Your home restores {{homeService.home.healthRegen}} health, {{homeService.home.staminaRegen}} stamina{{homeService.home.manaRegen > 0 ? ', ' + homeService.home.manaRegen + ' mana' : ''}} per day.</span></div>
        }
        @if (!hellService.inHell && !characterService.characterState.god) {
          <div class="homeInfo"><span>It costs {{homeService.home.costPerDay | bigNumber}} {{homeService.home.costPerDay === 1 ? "tael" : "taels"}} per day to maintain your home.</span></div>
        }
        <div class="homeInfo"><span>You own {{homeService.land | bigNumber}} open {{homeService.land === 1 ? "plot" : "plots"}} of land and {{homeService.fields.length + homeService.extraFields | bigNumber}} fields.</span></div>
          @if (getBasicFurnitureSlots().length > 0 && (!hellService.inHell || homeService.hellHome)) {
            <div class="furnitureSlots">
              @for (slot of getBasicFurnitureSlots(); track slot) {
                <div>
                  @if (!$any(homeService.furniture)[slot]) {
                    <div class="itemSlot" matTooltip="You don't own a {{getSlotDisplayName(slot)}}, but your home could hold one." (click)="storeClicked()"></div>
                  }
                  @if ($any(homeService.furniture)[slot]) {
                    <div class="itemSlot textOverflow" [matTooltip]="$any(homeService.furniture)[slot]?.description + '\n\n' + $any(homeService.furniture)[slot]?.effects" (click)="storeClicked()">{{$any(homeService.furniture)[slot]?.name | titlecase}}</div>
                  }
                </div>
              }
            </div>
          }
          @if (getWorkbenchSlots().length > 0 && (!hellService.inHell || homeService.hellHome)) {
            <div class="furnitureSlots">
              @for (slot of getWorkbenchSlots(); track slot) {
                <div>
                  @if (!$any(homeService.furniture)[slot]) {
                    <div class="itemSlot" matTooltip="You don't own a {{getSlotDisplayName(slot)}}, but your home could hold one." (click)="workbenchStoreClicked(slot)"></div>
                  }
                  @if ($any(homeService.furniture)[slot]) {
                    <div class="itemSlot textOverflow" [matTooltip]="$any(homeService.furniture)[slot]?.description + '\n\n' + $any(homeService.furniture)[slot]?.effects" (click)="workbenchStoreClicked(slot)">{{$any(homeService.furniture)[slot]?.name | titlecase}}</div>
                  }
                </div>
              }
            </div>
          }
          @if (homeService.home.furnitureSlots.length === 0) {
            <div class="furnitureSlots">
              <span class="mouseWarning">Tent living is rough. All these pesky mice could become a real problem. You might want to buy some land and get a better home.</span>
            </div>
          }
          @if (getActiveFurnitureEffects().length > 0) {
            <div class="furnitureEffects">
              <span class="furnitureEffectsHeader">Furniture Effects (per day):</span>
              @for (item of getActiveFurnitureEffects(); track item.name) {
                <span>{{item.name | titlecase}}{{item.count > 1 ? ' (' + item.count + ')' : ''}}: {{item.effects}}</span>
              }
            </div>
          }
        </div>
        <div class="buttons">
          @if (!hellService.inHell || homeService.hellHome) {
            <div class="button-group">
              <mat-icon  (click)="buyClicked($event)" [matTooltip]="'• Click to buy a plot of land for ' + (homeService.landPrice | bigNumber) + ' taels.\n• Shift-click to buy 10 plots for ' + getLandPrice(10) + ' taels.\n• Ctrl+Shift-click to buy 100 plots for ' + getLandPrice(100) + ' taels.\n• Ctrl-click to buy ' + getHalfAffordableLand() + ' plots (half the land you can afford).'" class="iconButton" aria-label="Buy Land" aria-hidden="false">
                add
              </mat-icon>
              @if ((homeService.home.name !== homeService.nextHome.name)) {
                <mat-icon (click)="homeService.upgradeToNextHome()" class="iconButton" aria-label="Upgrade Home" aria-hidden="false"
                  matTooltip="{{homeService.nextHome.upgradeToTooltip}}">
                  add_business
                </mat-icon>
              }
                            @if (homeService.upgrading) {
                <div class="progress-bar" style="height:20px;" matTooltip="Upgrading your home."
                  [attr.value]=buildTimeYears()>
                  <span [style.width.%]="100 * homeService.houseBuildingProgress"></span>
                </div>
                <span style="margin-left: 4px;"></span>
              }
            </div>
          }
          @if (!hellService.inHell || homeService.hellFood) {
            <div class="button-group">
              <mat-icon matTooltip="View your farm." class="iconButton" (click)="farmClicked()" aria-label="View Farm" aria-hidden="false">grass</mat-icon>
              <mat-icon  (click)="plowClicked($event)" class="iconButton" aria-label="Plow Field" aria-hidden="false"
                [matTooltip]="'Plow a field. Converts a plot of land to a field. You\'ll need to work at farming it to make it produce more food. Once the harvest is over, you will get the food you\'ve grown and the land will be available again.\n\n• Shift-click to plow 10 fields.\n• Ctrl+Shift-click to plow 100 fields.\n• Ctrl-click to plow all your land.'">
                waves
              </mat-icon>
              <mat-icon (click)="clearClicked($event)" class="iconButton" aria-label="Clear Field" aria-hidden="false"
                [matTooltip]="'Clear a field. Converts the field back into an open plot of land.\n\n• Shift-click to clear 10 fields.\n• Ctrl+Shift-click to clear 100 fields.\n• Ctrl-click to clear all your fields.'">
                delete_sweep
              </mat-icon>
            </div>
          }
        </div>
      </div>
    }
  </div>
  <div class="panelResizeHandle"></div>